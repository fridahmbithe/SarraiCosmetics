(()=>{var{__:e}=wp.i18n,t={calculateEventPosition:(e,t)=>{if("viewport"===t){return{top:e.target.getBoundingClientRect().top,left:e.target.getBoundingClientRect().left,right:e.target.getBoundingClientRect().right,bottom:e.target.getBoundingClientRect().bottom,width:e.target.getBoundingClientRect().width,height:e.target.getBoundingClientRect().height}}if("body"===t){let t=function(e){var t=0;do{isNaN(e.offsetLeft)||(t+=e.offsetLeft)}while(e=e.offsetParent);return t},n=function(e){var t=0;do{isNaN(e.offsetRight)||(t+=e.offsetRight)}while(e=e.offsetParent);return t},i=function(e){var t=0;do{isNaN(e.offsetBottom)||(t+=e.offsetBottom)}while(e=e.offsetParent);return t};return{top:function(e){var t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}(e.target),left:t(e.target),right:n(e.target),bottom:i(e.target),width:e.target.getBoundingClientRect().width,height:e.target.getBoundingClientRect().height}}},insertContextMenu:(e,t)=>{wp.data.dispatch("getgenie").setContextMenu({open:t,buttonEvent:{top:e.top,left:e.left,right:e.right,bottom:e.bottom,width:e.width,height:e.height}})},showSidebar:e=>{let t=wp.data.select("getgenie").sidebar().existingInputValue||"",n="WriteTemplatesScreen",i=t.split(/[.!?]+\s/).filter(Boolean).length,r=e.slug;"re-write"===r?r=i>1?"paragraph-rewriter":"sentence-rewriter":"list"===r&&(n="TemplateListScreen"),wp.data.dispatch("getgenie").setContextMenu({open:!1}),wp.data.dispatch("getgenie").setSidebar({open:!0,currentWritingMode:e?.mode,component:n,currentTemplate:r,existingInputValue:t.replace(/<br\s*[\/]?>/g,"")})}};jQuery(document).ready((function(e){const n=(e,t)=>{["INPUT","TEXTAREA"].includes(t?.tagName)?t.value=e.replace(/<br\s*[\/]?>/g,"\n"):t.innerText=e.replace(/<br\s*[\/]?>/g,"\n");const n=new Event("input",{bubbles:!0,cancelable:!0});t.dispatchEvent(n)},i=e=>{const t=jQuery(e).find("textarea"),n=jQuery(e).find("input[type=text]"),i=`${window.getGenie.config.assetsUrl}dist/admin/images/genie-dark.svg`;let r=elementor.settings.editorPreferences.model.get("ui_theme");"auto"===r&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(r="dark");const o=e=>`<button class="getgenie-trigger-btn ${e} ${r}"><img src=${i} alt="GetGenie" /></button>`;t.parent().append(o("getgenie-trigger-btn-textarea")),n.parent().append(o("getgenie-trigger-btn-text"))};$e.routes.on("run:after",((e,t)=>{"panel/editor/content"===t&&i(document.getElementById("elementor-panel"))})),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver((function(e,t){for(let t of e)!0===t.target.className.includes("elementor-control-type-section")&&i(t.target.parentElement)})).observe(document,{subtree:!0,attributeFilter:["class"],attributes:!0}),jQuery(document).on("click",".getgenie-trigger-btn",(function(e){e.preventDefault();let i=jQuery(this).siblings(["textarea","input[type=text]"]);if(0==i.length)return;let r=i[0]?.value;"INPUT"!==i[0]?.tagName&&"TEXTAREA"!==i[0]?.tagName&&(r=i[1]?.value,i=[i[1]]),i=i?.[0];let o,a,s=(r||"").substring(0,i?.selectionStart),g=(r||"").substring(i?.selectionEnd),l=window.getSelection(),u=l.toString(),c=jQuery(this).parents(".wp-editor-container");if(c.length>0&&"none"===c.find("textarea").css("display")){const e=document.querySelector("iframe").contentWindow,t=e.document,n=t.querySelector("body p");if(l=e.document.getSelection(),u=l.toString(),l?.focusNode&&(i=l.focusNode.parentNode,r=i.innerText,o=Math.min(l?.focusOffset,l?.baseOffset),a=Math.max(l?.focusOffset,l?.baseOffset),s=r.substring(0,o),g=r.substring(a)),!n){let e=t.createElement("p");return e.innerText=r,void t.querySelector("body").appendChild(e)}}let d=t.calculateEventPosition(e,"body");t.insertContextMenu(d,!wp.data.select("getgenie").contextMenu().open,u),l?.focusNode&&(wp.data.dispatch("getgenie").setSidebar({insertTextCallback:n,insertTextField:i,existingInputValue:u}),wp.data.dispatch("getgenie").setContextMenu({inputContent:{beforeCaret:s,selectedText:u,afterCaret:g},insertionField:i,contextMenuCallback:{continueWriting:(e,t,{beforeCaret:i,selectedText:r})=>{let o=e;" "!==r[r?.length-1]&&(o=" "+o),n(i+r+o,t)},expandOutline:(e,t,{beforeCaret:i,selectedText:r})=>{n(i+r+"\n"+e,t)},rewrite:(e,t,{beforeCaret:i,afterCaret:r})=>{let o=i;i&&(o+=" "),o+=e+" "+r,n(o,t)}}}))}))}))})();